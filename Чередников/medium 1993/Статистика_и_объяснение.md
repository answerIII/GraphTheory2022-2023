[https://leetcode.com/problems/operations-on-tree/submissions/933040230/](Статистика на leetcode)

Храню список детей, родителя и состояние для каждой вершины, а дальше просто использую DFS.